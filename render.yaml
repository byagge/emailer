services:
  - type: web
    name: emailer
    env: python

    # Build: install dependencies
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # Entry: run migrations, create superuser via shell command (if not exists), then launch Gunicorn
    startCommand: |
      bash -lc "\
        python manage.py migrate --no-input && \
        python manage.py shell -c \"from django.contrib.auth import get_user_model; \
User = get_user_model(); \
if not User.objects.filter(username='admin').exists(): \
    User.objects.create_superuser('admin','admin@example.com','admin123')\" && \
        gunicorn core.wsgi:application"
