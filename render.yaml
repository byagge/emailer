services:
  - type: web
    name: emailer
    env: python

    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: core.settings.dev

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # postdeploy: миграции и создание суперпользователя с email
    postdeploy:
      - python manage.py migrate --no-input
      - python manage.py shell -c "
from django.contrib.auth import get_user_model
User = get_user_model()
if not User.objects.filter(email='admin@example.com').exists():
    User.objects.create_superuser(email='admin@example.com', password='admin123')
print('✅ Superuser ready.')"

    startCommand: |
      gunicorn core.wsgi:application --bind 0.0.0.0:$PORT
