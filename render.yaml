services:
  - type: web
    name: emailer
    env: python

    # Build: install dependencies
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # Entry: run migrations, create superuser (if not exists), then launch Gunicorn
    startCommand: |
      bash -lc "\
        python manage.py migrate --no-input && \
        DJANGO_SUPERUSER_USERNAME=admin \
        DJANGO_SUPERUSER_EMAIL=admin@example.com \
        DJANGO_SUPERUSER_PASSWORD=admin123 \
        python manage.py createsuperuser --no-input || true && \
        gunicorn core.wsgi:application\"

    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: core.settings
      - key: PYTHON_VERSION
        value: "3.10"
