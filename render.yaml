services:
  - type: web
    name: emailer
    env: python

    # Переменные окружения
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: core.settings.dev    # подтянет SECRET_KEY из core/settings/dev.py
      # Для SQLite DATABASE_URL не нужен
      - key: DJANGO_SUPERUSER_USERNAME
        value: admin
      - key: DJANGO_SUPERUSER_EMAIL
        value: admin@example.com
      - key: DJANGO_SUPERUSER_PASSWORD
        value: admin123

    # Сборка: устанавливаем зависимости
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # После деплоя: применяем миграции и создаём суперпользователя (одноразово)
    postdeploy:
      - python manage.py migrate --no-input
      - python manage.py collectstatic --no-input  # если используете staticfiles
      - python manage.py createsuperuser --no-input

    # Запуск: только Gunicorn
    startCommand: |
      gunicorn core.wsgi:application --bind 0.0.0.0:$PORT
